# `src/AOtoMO/MOtoAO_GHF.f90`

## Overview

This file contains the `MOtoAO_GHF` subroutine, which is designed to transform a matrix from the Generalized Hartree-Fock (GHF) Molecular Orbital (MO) basis back to the Atomic Orbital (AO) basis. This is the reverse of an AO to MO transformation for GHF wavefunctions. The transformation involves an AO overlap matrix `S` and two sets of MO coefficients, `Ca` and `Cb`, which typically represent the two components of GHF spinors (often related to alpha and beta spin components). The final AO matrix `A` is constructed by summing the contributions from both coefficient sets:
A = (S * Ca) * B * (S * Ca)<sup>T</sup> + (S * Cb) * B * (S * Cb)<sup>T</sup>.

## Key Components

*   **Subroutine `MOtoAO_GHF`**
    *   Description: Performs the transformation of a matrix `B` from the GHF MO basis to the AO basis. It uses the AO overlap matrix `S` and the two GHF MO coefficient matrices `Ca` and `Cb`. The result is accumulated in matrix `A`.
    *   Type: Subroutine
    *   Key Arguments/Parameters:
        *   `nBas2` (Integer, Input): The number of molecular orbitals (i.e., the dimension of the input MO matrix `B` and the column dimension of `Ca` and `Cb`).
        *   `nBas` (Integer, Input): The number of atomic basis functions (i.e., the dimension of the overlap matrix `S` and the output AO matrix `A`, and the row dimension of `Ca` and `Cb`).
        *   `S(nBas,nBas)` (Double Precision, Input): The overlap matrix in the AO basis.
        *   `Ca(nBas,nBas2)` (Double Precision, Input): The first set of GHF MO coefficients.
        *   `Cb(nBas,nBas2)` (Double Precision, Input): The second set of GHF MO coefficients.
        *   `B(nBas2,nBas2)` (Double Precision, Input): The matrix in the GHF MO basis that is to be transformed.
        *   `A(nBas,nBas)` (Double Precision, Input/Output): The resulting matrix expressed in the AO basis. It's `intent(inout)` because the contributions from the `Ca` and `Cb` transformations are summed into `A`. The first contribution overwrites `A`, and the second is added to it.
    *   Return Value: None.

## Important Variables/Constants

*   **`SC(:,:)`**
    *   Description: An allocatable 2D array used as a temporary workspace. It first stores the product `S * Ca`, and later `S * Cb`.
    *   Type: Double Precision, Allocatable
    *   Scope: Local to Subroutine `MOtoAO_GHF`.
*   **`BSC(:,:)`**
    *   Description: An allocatable 2D array used as a temporary workspace. It stores the intermediate product `B * transpose(SC)`.
    *   Type: Double Precision, Allocatable
    *   Scope: Local to Subroutine `MOtoAO_GHF`.

## Usage Examples

```fortran
! Example of how to call SUBROUTINE MOtoAO_GHF
IMPLICIT NONE
INTEGER :: NUM_AO, NUM_MO_GHF
DOUBLE PRECISION, ALLOCATABLE :: S_MAT_AO(:,:), MO_COEFFS_A(:,:), MO_COEFFS_B(:,:)
DOUBLE PRECISION, ALLOCATABLE :: MATRIX_GHF_MO(:,:), MATRIX_AO_RESULT(:,:)

! ... (Initialize NUM_AO, NUM_MO_GHF)
! ... (Allocate and fill S_MAT_AO, MO_COEFFS_A, MO_COEFFS_B, MATRIX_GHF_MO)
! ... (Allocate MATRIX_AO_RESULT)
! Ensure MATRIX_AO_RESULT is initialized if needed, though the first part of the sum will overwrite it.

CALL MOtoAO_GHF(NUM_MO_GHF, NUM_AO, S_MAT_AO, MO_COEFFS_A, MO_COEFFS_B, MATRIX_GHF_MO, MATRIX_AO_RESULT)

! MATRIX_AO_RESULT now contains the matrix transformed to the AO basis.
! ... (Further calculations or analysis using MATRIX_AO_RESULT)
! ... (Deallocate arrays)
```

## Dependencies and Interactions

*   **Internal Dependencies:**
    *   None are explicitly shown via `USE` statements as the file contains a single subroutine.
*   **External Libraries:**
    *   `matmul`: This is an intrinsic Fortran function used for performing matrix multiplication.
    *   `transpose`: This is an intrinsic Fortran function used for transposing a matrix.
*   **Interactions:**
    *   This subroutine is typically employed in quantum chemistry programs that use a Generalized Hartree-Fock (GHF) approach.
    *   It is called when a matrix quantity (e.g., a density matrix, an operator averaged over GHF states) computed or represented in the GHF MO basis needs to be converted back into the AO basis. This conversion is often necessary for:
        *   Calculating properties that are defined in terms of AOs.
        *   Performing population analysis in the AO basis.
        *   Interfacing with other parts of a program that operate in the AO basis.

---
*This documentation was auto-generated by a script.*
